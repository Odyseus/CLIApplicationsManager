

<!DOCTYPE html>
<html class="no-js" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>python_modules.python_utils.diff_match_patch.diff_match_patch &mdash; Python CLI Applications Documentations  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/python-logo.svg"/>
  
  
  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: False" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Python CLI Applications Documentations
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/1-general-notes.html">General development notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/CLIApplicationsManager/index.html"><abbr title="Command Line Interface">CLI</abbr> applications manager's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/BackupUtils/index.html">Backup Utils' documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/BootstrapThemesGenerator/index.html">Bootstrap Themes Generator' documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/ChrootHelper/index.html">Chroot Helpers's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/FilesCleaner/index.html">Files Cleaner's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/HostsManager/index.html">Hosts Manager's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/JSONSchemaValidator/index.html">JSON Schema Validator's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/KnowledgeBase/index.html">Knowledge Base's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/MakeCinnamonXletPOT/index.html">Make Cinnamon Xlet POT's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/MoviesDB/index.html">Movies DB's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/PackageManager/index.html">Package Manager's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/UserApplicationsManager/index.html">User Applications Manager's documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/0-thirdparty_docs.d/docopt.html">docopt's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/0-thirdparty_docs.d/polib/index.html">polib's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/0-thirdparty_docs.d/pyperclip/index.html">pyperclip's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/0-thirdparty_docs.d/titlecase.html">titlecase's documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../includes/0-thirdparty_docs.d/tqdm.html">tqdm</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Python CLI Applications Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>python_modules.python_utils.diff_match_patch.diff_match_patch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for python_modules.python_utils.diff_match_patch.diff_match_patch</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="sd">&quot;&quot;&quot;Functions for diff, match and patch.</span>

<span class="sd">Computes the difference between two texts to create a patch.</span>
<span class="sd">Applies the patch onto another text, allowing for errors.</span>

<span class="sd">Diff Match and Patch</span>
<span class="sd">Copyright 2018 The diff-match-patch Authors.</span>
<span class="sd">https://github.com/google/diff-match-patch</span>

<span class="sd">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="sd">you may not use this file except in compliance with the License.</span>
<span class="sd">You may obtain a copy of the License at</span>

<span class="sd">  http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="sd">Unless required by applicable law or agreed to in writing, software</span>
<span class="sd">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="sd">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="sd">See the License for the specific language governing permissions and</span>
<span class="sd">limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;fraser@google.com (Neil Fraser)&#39;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>


<div class="viewcode-block" id="diff_match_patch"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch">[docs]</a><span class="k">class</span> <span class="nc">diff_match_patch</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class containing the diff, match and patch methods.</span>

<span class="sd">    Also contains the behaviour settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inits a diff_match_patch object with default settings.</span>
<span class="sd">        Redefine these in your program to override the defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Number of seconds to map a diff before giving up (0 for infinity).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Diff_Timeout</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="c1"># Cost of an empty edit operation in terms of edit characters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Diff_EditCost</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="c1"># At what point is no match declared (0.0 = perfection, 1.0 = very loose).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Match_Threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c1"># How far to search for a match (0 = exact location, 1000+ = broad match).</span>
        <span class="c1"># A match this many characters away from the expected location will add</span>
        <span class="c1"># 1.0 to the score (0.0 is a perfect match).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Match_Distance</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="c1"># When deleting a large block of text (over ~64 characters), how close do</span>
        <span class="c1"># the contents have to be to match the expected contents. (0.0 = perfection,</span>
        <span class="c1"># 1.0 = very loose).  Note that Match_Threshold controls how closely the</span>
        <span class="c1"># end points of a delete need to match.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Patch_DeleteThreshold</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c1"># Chunk size for context length.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># The number of bits in an int.</span>
        <span class="c1"># Python has no maximum, thus to disable patch splitting set to 0.</span>
        <span class="c1"># However to avoid long patches in certain pathological cases, use 32.</span>
        <span class="c1"># Multiple short patches (using native ints) are much faster than long ones.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span> <span class="o">=</span> <span class="mi">32</span>

    <span class="c1">#  DIFF FUNCTIONS</span>

    <span class="c1"># The data structure representing a diff is an array of tuples:</span>
    <span class="c1"># [(DIFF_DELETE, &quot;Hello&quot;), (DIFF_INSERT, &quot;Goodbye&quot;), (DIFF_EQUAL, &quot; world.&quot;)]</span>
    <span class="c1"># which means: delete &quot;Hello&quot;, add &quot;Goodbye&quot; and keep &quot; world.&quot;</span>
    <span class="n">DIFF_DELETE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">DIFF_INSERT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DIFF_EQUAL</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="diff_match_patch.diff_main"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_main">[docs]</a>    <span class="k">def</span> <span class="nf">diff_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">checklines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the differences between two texts.  Simplifies the problem by</span>
<span class="sd">          stripping any common prefix or suffix off the texts before diffing.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Old string to be diffed.</span>
<span class="sd">          text2: New string to be diffed.</span>
<span class="sd">          checklines: Optional speedup flag.  If present and false, then don&#39;t run</span>
<span class="sd">            a line-level diff first to identify the changed areas.</span>
<span class="sd">            Defaults to true, which does a faster, slightly less optimal diff.</span>
<span class="sd">          deadline: Optional time when the diff should be complete by.  Used</span>
<span class="sd">            internally for recursive calls.  Users should set DiffTimeout instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set a deadline by which time the diff must be complete.</span>
        <span class="k">if</span> <span class="n">deadline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Unlike in most languages, Python counts time in seconds.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diff_Timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">deadline</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">deadline</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diff_Timeout</span>

        <span class="c1"># Check for null inputs.</span>
        <span class="k">if</span> <span class="n">text1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">text2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Null inputs. (diff_main)&quot;</span><span class="p">)</span>

        <span class="c1"># Check for equality (speedup).</span>
        <span class="k">if</span> <span class="n">text1</span> <span class="o">==</span> <span class="n">text2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">text1</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Trim off common prefix (speedup).</span>
        <span class="n">commonlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonPrefix</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="n">commonprefix</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[:</span><span class="n">commonlength</span><span class="p">]</span>
        <span class="n">text1</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="n">commonlength</span><span class="p">:]</span>
        <span class="n">text2</span> <span class="o">=</span> <span class="n">text2</span><span class="p">[</span><span class="n">commonlength</span><span class="p">:]</span>

        <span class="c1"># Trim off common suffix (speedup).</span>
        <span class="n">commonlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonSuffix</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commonlength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">commonsuffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commonsuffix</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">commonlength</span><span class="p">:]</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[:</span><span class="o">-</span><span class="n">commonlength</span><span class="p">]</span>
            <span class="n">text2</span> <span class="o">=</span> <span class="n">text2</span><span class="p">[:</span><span class="o">-</span><span class="n">commonlength</span><span class="p">]</span>

        <span class="c1"># Compute the diff on the middle block.</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_compute</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">checklines</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

        <span class="c1"># Restore the prefix and suffix.</span>
        <span class="k">if</span> <span class="n">commonprefix</span><span class="p">:</span>
            <span class="n">diffs</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">commonprefix</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">commonsuffix</span><span class="p">:</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">commonsuffix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupMerge</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diffs</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_compute"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_compute">[docs]</a>    <span class="k">def</span> <span class="nf">diff_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">checklines</span><span class="p">,</span> <span class="n">deadline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the differences between two texts.  Assumes that the texts do not</span>
<span class="sd">          have any common prefix or suffix.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Old string to be diffed.</span>
<span class="sd">          text2: New string to be diffed.</span>
<span class="sd">          checklines: Speedup flag.  If false, then don&#39;t run a line-level diff</span>
<span class="sd">            first to identify the changed areas.</span>
<span class="sd">            If true, then run a faster, slightly less optimal diff.</span>
<span class="sd">          deadline: Time when the diff should be complete by.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text1</span><span class="p">:</span>
            <span class="c1"># Just add some text (speedup).</span>
            <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">text2</span><span class="p">)]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">text2</span><span class="p">:</span>
            <span class="c1"># Just delete some text (speedup).</span>
            <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">text1</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">):</span>
            <span class="p">(</span><span class="n">longtext</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">shorttext</span><span class="p">,</span> <span class="n">longtext</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">longtext</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">shorttext</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Shorter text is inside the longer text (speedup).</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">longtext</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">),</span>
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">longtext</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">shorttext</span><span class="p">):])]</span>
            <span class="c1"># Swap insertions for deletions if diff is reversed.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">):</span>
                <span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">diffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">diffs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">diffs</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shorttext</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single character string.</span>
            <span class="c1"># After the previous speedup, the character can&#39;t be an equality.</span>
            <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">text1</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">text2</span><span class="p">)]</span>

        <span class="c1"># Check to see if the problem can be split in two.</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_halfMatch</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hm</span><span class="p">:</span>
            <span class="c1"># A half-match was found, sort out the return data.</span>
            <span class="p">(</span><span class="n">text1_a</span><span class="p">,</span> <span class="n">text1_b</span><span class="p">,</span> <span class="n">text2_a</span><span class="p">,</span> <span class="n">text2_b</span><span class="p">,</span> <span class="n">mid_common</span><span class="p">)</span> <span class="o">=</span> <span class="n">hm</span>
            <span class="c1"># Send both pairs off for separate processing.</span>
            <span class="n">diffs_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1_a</span><span class="p">,</span> <span class="n">text2_a</span><span class="p">,</span> <span class="n">checklines</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>
            <span class="n">diffs_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1_b</span><span class="p">,</span> <span class="n">text2_b</span><span class="p">,</span> <span class="n">checklines</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>
            <span class="c1"># Merge the results.</span>
            <span class="k">return</span> <span class="n">diffs_a</span> <span class="o">+</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">mid_common</span><span class="p">)]</span> <span class="o">+</span> <span class="n">diffs_b</span>

        <span class="k">if</span> <span class="n">checklines</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_lineMode</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_bisect</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_lineMode"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_lineMode">[docs]</a>    <span class="k">def</span> <span class="nf">diff_lineMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">deadline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do a quick line-level diff on both strings, then rediff the parts for</span>
<span class="sd">          greater accuracy.</span>
<span class="sd">          This speedup can produce non-minimal diffs.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Old string to be diffed.</span>
<span class="sd">          text2: New string to be diffed.</span>
<span class="sd">          deadline: Time when the diff should be complete by.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Scan the text on a line-by-line basis first.</span>
        <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">linearray</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_linesToChars</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>

        <span class="n">diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

        <span class="c1"># Convert the diff back to original text.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff_charsToLines</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">linearray</span><span class="p">)</span>
        <span class="c1"># Eliminate freak matches (e.g. blank lines)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupSemantic</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>

        <span class="c1"># Rediff any replacement blocks, this time character-by-character.</span>
        <span class="c1"># Add a dummy entry at the end.</span>
        <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_delete</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_insert</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text_delete</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text_insert</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">count_insert</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">text_insert</span> <span class="o">+=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">count_delete</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">text_delete</span> <span class="o">+=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="c1"># Upon reaching an equality, check for prior redundancies.</span>
                <span class="k">if</span> <span class="n">count_delete</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">count_insert</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Delete the offending records and add the merged ones.</span>
                    <span class="n">subDiff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text_delete</span><span class="p">,</span> <span class="n">text_insert</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="n">count_delete</span> <span class="o">-</span> <span class="n">count_insert</span><span class="p">:</span> <span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="n">subDiff</span>
                    <span class="n">pointer</span> <span class="o">=</span> <span class="n">pointer</span> <span class="o">-</span> <span class="n">count_delete</span> <span class="o">-</span> <span class="n">count_insert</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subDiff</span><span class="p">)</span>
                <span class="n">count_insert</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">count_delete</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">text_delete</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">text_insert</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">diffs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Remove the dummy entry at the end.</span>

        <span class="k">return</span> <span class="n">diffs</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_bisect"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_bisect">[docs]</a>    <span class="k">def</span> <span class="nf">diff_bisect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">deadline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the &#39;middle snake&#39; of a diff, split the problem in two</span>
<span class="sd">          and return the recursively constructed diff.</span>
<span class="sd">          See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Old string to be diffed.</span>
<span class="sd">          text2: New string to be diffed.</span>
<span class="sd">          deadline: Time at which to bail if not yet complete.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Cache the text lengths to prevent multiple calls.</span>
        <span class="n">text1_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
        <span class="n">text2_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
        <span class="n">max_d</span> <span class="o">=</span> <span class="p">(</span><span class="n">text1_length</span> <span class="o">+</span> <span class="n">text2_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">v_offset</span> <span class="o">=</span> <span class="n">max_d</span>
        <span class="n">v_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">max_d</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_length</span>
        <span class="n">v1</span><span class="p">[</span><span class="n">v_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[:]</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">text1_length</span> <span class="o">-</span> <span class="n">text2_length</span>
        <span class="c1"># If the total number of characters is odd, then the front path will</span>
        <span class="c1"># collide with the reverse path.</span>
        <span class="n">front</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Offsets for start and end of k loop.</span>
        <span class="c1"># Prevents mapping of space beyond the grid.</span>
        <span class="n">k1start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k1end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k2start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k2end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_d</span><span class="p">):</span>
            <span class="c1"># Bail out if deadline is reached.</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">deadline</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># Walk the front path one step.</span>
            <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">+</span> <span class="n">k1start</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">k1end</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">k1_offset</span> <span class="o">=</span> <span class="n">v_offset</span> <span class="o">+</span> <span class="n">k1</span>
                <span class="k">if</span> <span class="n">k1</span> <span class="o">==</span> <span class="o">-</span><span class="n">d</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k1</span> <span class="o">!=</span> <span class="n">d</span> <span class="ow">and</span>
                                <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">k1</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="n">text1_length</span> <span class="ow">and</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="n">text2_length</span> <span class="ow">and</span>
                       <span class="n">text1</span><span class="p">[</span><span class="n">x1</span><span class="p">]</span> <span class="o">==</span> <span class="n">text2</span><span class="p">[</span><span class="n">y1</span><span class="p">]):</span>
                    <span class="n">x1</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">y1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">text1_length</span><span class="p">:</span>
                    <span class="c1"># Ran off the right of the graph.</span>
                    <span class="n">k1end</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="n">text2_length</span><span class="p">:</span>
                    <span class="c1"># Ran off the bottom of the graph.</span>
                    <span class="n">k1start</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">front</span><span class="p">:</span>
                    <span class="n">k2_offset</span> <span class="o">=</span> <span class="n">v_offset</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">-</span> <span class="n">k1</span>
                    <span class="k">if</span> <span class="n">k2_offset</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k2_offset</span> <span class="o">&lt;</span> <span class="n">v_length</span> <span class="ow">and</span> <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Mirror x2 onto top-left coordinate system.</span>
                        <span class="n">x2</span> <span class="o">=</span> <span class="n">text1_length</span> <span class="o">-</span> <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;=</span> <span class="n">x2</span><span class="p">:</span>
                            <span class="c1"># Overlap detected.</span>
                            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_bisectSplit</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

            <span class="c1"># Walk the reverse path one step.</span>
            <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">+</span> <span class="n">k2start</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">k2end</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">k2_offset</span> <span class="o">=</span> <span class="n">v_offset</span> <span class="o">+</span> <span class="n">k2</span>
                <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="o">-</span><span class="n">d</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k2</span> <span class="o">!=</span> <span class="n">d</span> <span class="ow">and</span>
                                <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">k2</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">x2</span> <span class="o">&lt;</span> <span class="n">text1_length</span> <span class="ow">and</span> <span class="n">y2</span> <span class="o">&lt;</span> <span class="n">text2_length</span> <span class="ow">and</span>
                       <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">x2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">text2</span><span class="p">[</span><span class="o">-</span><span class="n">y2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                    <span class="n">x2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">y2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">v2</span><span class="p">[</span><span class="n">k2_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span>
                <span class="k">if</span> <span class="n">x2</span> <span class="o">&gt;</span> <span class="n">text1_length</span><span class="p">:</span>
                    <span class="c1"># Ran off the left of the graph.</span>
                    <span class="n">k2end</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">y2</span> <span class="o">&gt;</span> <span class="n">text2_length</span><span class="p">:</span>
                    <span class="c1"># Ran off the top of the graph.</span>
                    <span class="n">k2start</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">front</span><span class="p">:</span>
                    <span class="n">k1_offset</span> <span class="o">=</span> <span class="n">v_offset</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">-</span> <span class="n">k2</span>
                    <span class="k">if</span> <span class="n">k1_offset</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k1_offset</span> <span class="o">&lt;</span> <span class="n">v_length</span> <span class="ow">and</span> <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">x1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">k1_offset</span><span class="p">]</span>
                        <span class="n">y1</span> <span class="o">=</span> <span class="n">v_offset</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">k1_offset</span>
                        <span class="c1"># Mirror x2 onto top-left coordinate system.</span>
                        <span class="n">x2</span> <span class="o">=</span> <span class="n">text1_length</span> <span class="o">-</span> <span class="n">x2</span>
                        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;=</span> <span class="n">x2</span><span class="p">:</span>
                            <span class="c1"># Overlap detected.</span>
                            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_bisectSplit</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

        <span class="c1"># Diff took too long and hit the deadline or</span>
        <span class="c1"># number of diffs equals number of characters, no commonality at all.</span>
        <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">text1</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">text2</span><span class="p">)]</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_bisectSplit"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_bisectSplit">[docs]</a>    <span class="k">def</span> <span class="nf">diff_bisectSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deadline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given the location of the &#39;middle snake&#39;, split the diff in two parts</span>
<span class="sd">        and recurse.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Old string to be diffed.</span>
<span class="sd">          text2: New string to be diffed.</span>
<span class="sd">          x: Index of split point in text1.</span>
<span class="sd">          y: Index of split point in text2.</span>
<span class="sd">          deadline: Time at which to bail if not yet complete.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text1a</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[:</span><span class="n">x</span><span class="p">]</span>
        <span class="n">text2a</span> <span class="o">=</span> <span class="n">text2</span><span class="p">[:</span><span class="n">y</span><span class="p">]</span>
        <span class="n">text1b</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="n">x</span><span class="p">:]</span>
        <span class="n">text2b</span> <span class="o">=</span> <span class="n">text2</span><span class="p">[</span><span class="n">y</span><span class="p">:]</span>

        <span class="c1"># Compute both diffs serially.</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1a</span><span class="p">,</span> <span class="n">text2a</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>
        <span class="n">diffsb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1b</span><span class="p">,</span> <span class="n">text2b</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">deadline</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">diffs</span> <span class="o">+</span> <span class="n">diffsb</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_linesToChars"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_linesToChars">[docs]</a>    <span class="k">def</span> <span class="nf">diff_linesToChars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split two texts into an array of strings.  Reduce the texts to a string</span>
<span class="sd">        of hashes where each Unicode character represents one line.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: First string.</span>
<span class="sd">          text2: Second string.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Three element tuple, containing the encoded text1, the encoded text2 and</span>
<span class="sd">          the array of unique strings.  The zeroth element of the array of unique</span>
<span class="sd">          strings is intentionally blank.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lineArray</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># e.g. lineArray[4] == &quot;Hello\n&quot;</span>
        <span class="n">lineHash</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># e.g. lineHash[&quot;Hello\n&quot;] == 4</span>

        <span class="c1"># &quot;\x00&quot; is a valid character, but various debuggers don&#39;t like it.</span>
        <span class="c1"># So we&#39;ll insert a junk entry to avoid generating a null character.</span>
        <span class="n">lineArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">diff_linesToCharsMunge</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Split a text into an array of strings.  Reduce the texts to a string</span>
<span class="sd">            of hashes where each Unicode character represents one line.</span>
<span class="sd">            Modifies linearray and linehash through being a closure.</span>

<span class="sd">            Args:</span>
<span class="sd">              text: String to encode.</span>

<span class="sd">            Returns:</span>
<span class="sd">              Encoded string.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Walk the text, pulling out a substring for each line.</span>
            <span class="c1"># text.split(&#39;\n&#39;) would would temporarily double our memory footprint.</span>
            <span class="c1"># Modifying text would create many large strings to garbage collect.</span>
            <span class="n">lineStart</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lineEnd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">while</span> <span class="n">lineEnd</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lineEnd</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">lineStart</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lineEnd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">lineEnd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">lineStart</span><span class="p">:</span><span class="n">lineEnd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lineHash</span><span class="p">:</span>
                    <span class="n">chars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">lineHash</span><span class="p">[</span><span class="n">line</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">==</span> <span class="n">maxLines</span><span class="p">:</span>
                        <span class="c1"># Bail out at 1114111 because chr(1114112) throws.</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">lineStart</span><span class="p">:]</span>
                        <span class="n">lineEnd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">lineArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">lineHash</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">chars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">lineStart</span> <span class="o">=</span> <span class="n">lineEnd</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>

        <span class="c1"># Allocate 2/3rds of the space for text1, the rest for text2.</span>
        <span class="n">maxLines</span> <span class="o">=</span> <span class="mi">666666</span>
        <span class="n">chars1</span> <span class="o">=</span> <span class="n">diff_linesToCharsMunge</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
        <span class="n">maxLines</span> <span class="o">=</span> <span class="mi">1114111</span>
        <span class="n">chars2</span> <span class="o">=</span> <span class="n">diff_linesToCharsMunge</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">chars1</span><span class="p">,</span> <span class="n">chars2</span><span class="p">,</span> <span class="n">lineArray</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_charsToLines"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_charsToLines">[docs]</a>    <span class="k">def</span> <span class="nf">diff_charsToLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">lineArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rehydrate the text in a diff from a string of line hashes to real lines</span>
<span class="sd">        of text.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">          lineArray: Array of unique strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)])</span>
            <span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">))</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_commonPrefix"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_commonPrefix">[docs]</a>    <span class="k">def</span> <span class="nf">diff_commonPrefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the common prefix of two strings.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: First string.</span>
<span class="sd">          text2: Second string.</span>

<span class="sd">        Returns:</span>
<span class="sd">          The number of characters common to the start of each string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Quick check for common null cases.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text2</span> <span class="ow">or</span> <span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">text2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># Binary search.</span>
        <span class="c1"># Performance analysis: https://neil.fraser.name/news/2007/10/09/</span>
        <span class="n">pointermin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pointermax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">))</span>
        <span class="n">pointermid</span> <span class="o">=</span> <span class="n">pointermax</span>
        <span class="n">pointerstart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">pointermin</span> <span class="o">&lt;</span> <span class="n">pointermid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text1</span><span class="p">[</span><span class="n">pointerstart</span><span class="p">:</span><span class="n">pointermid</span><span class="p">]</span> <span class="o">==</span> <span class="n">text2</span><span class="p">[</span><span class="n">pointerstart</span><span class="p">:</span><span class="n">pointermid</span><span class="p">]:</span>
                <span class="n">pointermin</span> <span class="o">=</span> <span class="n">pointermid</span>
                <span class="n">pointerstart</span> <span class="o">=</span> <span class="n">pointermin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pointermax</span> <span class="o">=</span> <span class="n">pointermid</span>
            <span class="n">pointermid</span> <span class="o">=</span> <span class="p">(</span><span class="n">pointermax</span> <span class="o">-</span> <span class="n">pointermin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pointermin</span>
        <span class="k">return</span> <span class="n">pointermid</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_commonSuffix"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_commonSuffix">[docs]</a>    <span class="k">def</span> <span class="nf">diff_commonSuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the common suffix of two strings.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: First string.</span>
<span class="sd">          text2: Second string.</span>

<span class="sd">        Returns:</span>
<span class="sd">          The number of characters common to the end of each string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Quick check for common null cases.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text2</span> <span class="ow">or</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">text2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># Binary search.</span>
        <span class="c1"># Performance analysis: https://neil.fraser.name/news/2007/10/09/</span>
        <span class="n">pointermin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pointermax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">))</span>
        <span class="n">pointermid</span> <span class="o">=</span> <span class="n">pointermax</span>
        <span class="n">pointerend</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">pointermin</span> <span class="o">&lt;</span> <span class="n">pointermid</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">pointermid</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">-</span> <span class="n">pointerend</span><span class="p">]</span> <span class="o">==</span>
                    <span class="n">text2</span><span class="p">[</span><span class="o">-</span><span class="n">pointermid</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pointerend</span><span class="p">]):</span>
                <span class="n">pointermin</span> <span class="o">=</span> <span class="n">pointermid</span>
                <span class="n">pointerend</span> <span class="o">=</span> <span class="n">pointermin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pointermax</span> <span class="o">=</span> <span class="n">pointermid</span>
            <span class="n">pointermid</span> <span class="o">=</span> <span class="p">(</span><span class="n">pointermax</span> <span class="o">-</span> <span class="n">pointermin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pointermin</span>
        <span class="k">return</span> <span class="n">pointermid</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_commonOverlap"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_commonOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">diff_commonOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if the suffix of one string is the prefix of another.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1 First string.</span>
<span class="sd">          text2 Second string.</span>

<span class="sd">        Returns:</span>
<span class="sd">          The number of characters common to the end of the first</span>
<span class="sd">          string and the start of the second string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Cache the text lengths to prevent multiple calls.</span>
        <span class="n">text1_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
        <span class="n">text2_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
        <span class="c1"># Eliminate the null case.</span>
        <span class="k">if</span> <span class="n">text1_length</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">text2_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># Truncate the longer string.</span>
        <span class="k">if</span> <span class="n">text1_length</span> <span class="o">&gt;</span> <span class="n">text2_length</span><span class="p">:</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">text2_length</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">text1_length</span> <span class="o">&lt;</span> <span class="n">text2_length</span><span class="p">:</span>
            <span class="n">text2</span> <span class="o">=</span> <span class="n">text2</span><span class="p">[:</span><span class="n">text1_length</span><span class="p">]</span>
        <span class="n">text_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">text1_length</span><span class="p">,</span> <span class="n">text2_length</span><span class="p">)</span>
        <span class="c1"># Quick check for the worst case.</span>
        <span class="k">if</span> <span class="n">text1</span> <span class="o">==</span> <span class="n">text2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text_length</span>

        <span class="c1"># Start by looking for a single character match</span>
        <span class="c1"># and increase length until no match is found.</span>
        <span class="c1"># Performance analysis: https://neil.fraser.name/news/2010/11/04/</span>
        <span class="n">best</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">length</span><span class="p">:]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">text2</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">best</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="n">found</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="n">length</span><span class="p">:]</span> <span class="o">==</span> <span class="n">text2</span><span class="p">[:</span><span class="n">length</span><span class="p">]:</span>
                <span class="n">best</span> <span class="o">=</span> <span class="n">length</span>
                <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_halfMatch"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_halfMatch">[docs]</a>    <span class="k">def</span> <span class="nf">diff_halfMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do the two texts share a substring which is at least half the length of</span>
<span class="sd">        the longer text?</span>
<span class="sd">        This speedup can produce non-minimal diffs.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: First string.</span>
<span class="sd">          text2: Second string.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Five element Array, containing the prefix of text1, the suffix of text1,</span>
<span class="sd">          the prefix of text2, the suffix of text2 and the common middle.  Or None</span>
<span class="sd">          if there was no match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diff_Timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Don&#39;t risk returning a non-optimal diff if we have unlimited time.</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">):</span>
            <span class="p">(</span><span class="n">longtext</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">shorttext</span><span class="p">,</span> <span class="n">longtext</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">shorttext</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Pointless.</span>

        <span class="k">def</span> <span class="nf">diff_halfMatchI</span><span class="p">(</span><span class="n">longtext</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Does a substring of shorttext exist within longtext such that the</span>
<span class="sd">            substring is at least half the length of longtext?</span>
<span class="sd">            Closure, but does not reference any external variables.</span>

<span class="sd">            Args:</span>
<span class="sd">              longtext: Longer string.</span>
<span class="sd">              shorttext: Shorter string.</span>
<span class="sd">              i: Start index of quarter length substring within longtext.</span>

<span class="sd">            Returns:</span>
<span class="sd">              Five element Array, containing the prefix of longtext, the suffix of</span>
<span class="sd">              longtext, the prefix of shorttext, the suffix of shorttext and the</span>
<span class="sd">              common middle.  Or None if there was no match.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="n">longtext</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">]</span>
            <span class="n">best_common</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">shorttext</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">prefixLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonPrefix</span><span class="p">(</span><span class="n">longtext</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">shorttext</span><span class="p">[</span><span class="n">j</span><span class="p">:])</span>
                <span class="n">suffixLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonSuffix</span><span class="p">(</span><span class="n">longtext</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">shorttext</span><span class="p">[:</span><span class="n">j</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_common</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">suffixLength</span> <span class="o">+</span> <span class="n">prefixLength</span><span class="p">:</span>
                    <span class="n">best_common</span> <span class="o">=</span> <span class="p">(</span><span class="n">shorttext</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">suffixLength</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span>
                                   <span class="n">shorttext</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span> <span class="o">+</span> <span class="n">prefixLength</span><span class="p">])</span>
                    <span class="n">best_longtext_a</span> <span class="o">=</span> <span class="n">longtext</span><span class="p">[:</span><span class="n">i</span> <span class="o">-</span> <span class="n">suffixLength</span><span class="p">]</span>
                    <span class="n">best_longtext_b</span> <span class="o">=</span> <span class="n">longtext</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">prefixLength</span><span class="p">:]</span>
                    <span class="n">best_shorttext_a</span> <span class="o">=</span> <span class="n">shorttext</span><span class="p">[:</span><span class="n">j</span> <span class="o">-</span> <span class="n">suffixLength</span><span class="p">]</span>
                    <span class="n">best_shorttext_b</span> <span class="o">=</span> <span class="n">shorttext</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">prefixLength</span><span class="p">:]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">shorttext</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_common</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">best_longtext_a</span><span class="p">,</span> <span class="n">best_longtext_b</span><span class="p">,</span>
                        <span class="n">best_shorttext_a</span><span class="p">,</span> <span class="n">best_shorttext_b</span><span class="p">,</span> <span class="n">best_common</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># First check if the second quarter is the seed for a half-match.</span>
        <span class="n">hm1</span> <span class="o">=</span> <span class="n">diff_halfMatchI</span><span class="p">(</span><span class="n">longtext</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># Check again based on the third quarter.</span>
        <span class="n">hm2</span> <span class="o">=</span> <span class="n">diff_halfMatchI</span><span class="p">(</span><span class="n">longtext</span><span class="p">,</span> <span class="n">shorttext</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">longtext</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hm1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hm2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">hm2</span><span class="p">:</span>
            <span class="n">hm</span> <span class="o">=</span> <span class="n">hm1</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">hm1</span><span class="p">:</span>
            <span class="n">hm</span> <span class="o">=</span> <span class="n">hm2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Both matched.  Select the longest.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hm1</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">hm2</span><span class="p">[</span><span class="mi">4</span><span class="p">]):</span>
                <span class="n">hm</span> <span class="o">=</span> <span class="n">hm1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hm</span> <span class="o">=</span> <span class="n">hm2</span>

        <span class="c1"># A half-match was found, sort out the return data.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text2</span><span class="p">):</span>
            <span class="p">(</span><span class="n">text1_a</span><span class="p">,</span> <span class="n">text1_b</span><span class="p">,</span> <span class="n">text2_a</span><span class="p">,</span> <span class="n">text2_b</span><span class="p">,</span> <span class="n">mid_common</span><span class="p">)</span> <span class="o">=</span> <span class="n">hm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">text2_a</span><span class="p">,</span> <span class="n">text2_b</span><span class="p">,</span> <span class="n">text1_a</span><span class="p">,</span> <span class="n">text1_b</span><span class="p">,</span> <span class="n">mid_common</span><span class="p">)</span> <span class="o">=</span> <span class="n">hm</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">text1_a</span><span class="p">,</span> <span class="n">text1_b</span><span class="p">,</span> <span class="n">text2_a</span><span class="p">,</span> <span class="n">text2_b</span><span class="p">,</span> <span class="n">mid_common</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_cleanupSemantic"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_cleanupSemantic">[docs]</a>    <span class="k">def</span> <span class="nf">diff_cleanupSemantic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reduce the number of edits by eliminating semantically trivial</span>
<span class="sd">        equalities.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">equalities</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Stack of indices where equalities are found.</span>
        <span class="n">lastEquality</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Always equal to diffs[equalities[-1]][1]</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Index of current position.</span>
        <span class="c1"># Number of chars that changed prior to the equality.</span>
        <span class="n">length_insertions1</span><span class="p">,</span> <span class="n">length_deletions1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="c1"># Number of chars that changed after the equality.</span>
        <span class="n">length_insertions2</span><span class="p">,</span> <span class="n">length_deletions2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>  <span class="c1"># Equality found.</span>
                <span class="n">equalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span>
                <span class="n">length_insertions1</span><span class="p">,</span> <span class="n">length_insertions2</span> <span class="o">=</span> <span class="n">length_insertions2</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">length_deletions1</span><span class="p">,</span> <span class="n">length_deletions2</span> <span class="o">=</span> <span class="n">length_deletions2</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">lastEquality</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># An insertion or deletion.</span>
                <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                    <span class="n">length_insertions2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">length_deletions2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># Eliminate an equality that is smaller or equal to the edits on both</span>
                <span class="c1"># sides of it.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lastEquality</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lastEquality</span><span class="p">)</span> <span class="o">&lt;=</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">length_insertions1</span><span class="p">,</span> <span class="n">length_deletions1</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lastEquality</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">length_insertions2</span><span class="p">,</span> <span class="n">length_deletions2</span><span class="p">))):</span>
                    <span class="c1"># Duplicate record.</span>
                    <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">lastEquality</span><span class="p">))</span>
                    <span class="c1"># Change second copy to insert.</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span>
                                                 <span class="n">diffs</span><span class="p">[</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1"># Throw away the equality we just deleted.</span>
                    <span class="n">equalities</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="c1"># Throw away the previous equality (it needs to be reevaluated).</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equalities</span><span class="p">):</span>
                        <span class="n">equalities</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equalities</span><span class="p">):</span>
                        <span class="n">pointer</span> <span class="o">=</span> <span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pointer</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="c1"># Reset the counters.</span>
                    <span class="n">length_insertions1</span><span class="p">,</span> <span class="n">length_deletions1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="n">length_insertions2</span><span class="p">,</span> <span class="n">length_deletions2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="n">lastEquality</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">changes</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Normalize the diff.</span>
        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupMerge</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupSemanticLossless</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>

        <span class="c1"># Find any overlaps between deletions and insertions.</span>
        <span class="c1"># e.g: &lt;del&gt;abcxxx&lt;/del&gt;&lt;ins&gt;xxxdef&lt;/ins&gt;</span>
        <span class="c1">#   -&gt; &lt;del&gt;abc&lt;/del&gt;xxx&lt;ins&gt;def&lt;/ins&gt;</span>
        <span class="c1"># e.g: &lt;del&gt;xxxabc&lt;/del&gt;&lt;ins&gt;defxxx&lt;/ins&gt;</span>
        <span class="c1">#   -&gt; &lt;ins&gt;def&lt;/ins&gt;xxx&lt;del&gt;abc&lt;/del&gt;</span>
        <span class="c1"># Only extract an overlap if it is as big as the edit ahead or behind it.</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span> <span class="ow">and</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">):</span>
                <span class="n">deletion</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">insertion</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">overlap_length1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonOverlap</span><span class="p">(</span><span class="n">deletion</span><span class="p">,</span> <span class="n">insertion</span><span class="p">)</span>
                <span class="n">overlap_length2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonOverlap</span><span class="p">(</span><span class="n">insertion</span><span class="p">,</span> <span class="n">deletion</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">overlap_length1</span> <span class="o">&gt;=</span> <span class="n">overlap_length2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">overlap_length1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deletion</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="ow">or</span>
                            <span class="n">overlap_length1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">insertion</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                        <span class="c1"># Overlap found.  Insert an equality and trim the surrounding edits.</span>
                        <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pointer</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span>
                                               <span class="n">insertion</span><span class="p">[:</span><span class="n">overlap_length1</span><span class="p">]))</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span>
                                              <span class="n">deletion</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">deletion</span><span class="p">)</span> <span class="o">-</span> <span class="n">overlap_length1</span><span class="p">])</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span>
                                              <span class="n">insertion</span><span class="p">[</span><span class="n">overlap_length1</span><span class="p">:])</span>
                        <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">overlap_length2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deletion</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="ow">or</span>
                            <span class="n">overlap_length2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">insertion</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                        <span class="c1"># Reverse overlap found.</span>
                        <span class="c1"># Insert an equality and swap and trim the surrounding edits.</span>
                        <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pointer</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">deletion</span><span class="p">[:</span><span class="n">overlap_length2</span><span class="p">]))</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span>
                                              <span class="n">insertion</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">insertion</span><span class="p">)</span> <span class="o">-</span> <span class="n">overlap_length2</span><span class="p">])</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">deletion</span><span class="p">[</span><span class="n">overlap_length2</span><span class="p">:])</span>
                        <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_cleanupSemanticLossless"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_cleanupSemanticLossless">[docs]</a>    <span class="k">def</span> <span class="nf">diff_cleanupSemanticLossless</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look for single edits surrounded on both sides by equalities</span>
<span class="sd">        which can be shifted sideways to align the edit to a word boundary.</span>
<span class="sd">        e.g: The c&lt;ins&gt;at c&lt;/ins&gt;ame. -&gt; The &lt;ins&gt;cat &lt;/ins&gt;came.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">diff_cleanupSemanticScore</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Given two strings, compute a score representing whether the</span>
<span class="sd">            internal boundary falls on logical boundaries.</span>
<span class="sd">            Scores range from 6 (best) to 0 (worst).</span>
<span class="sd">            Closure, but does not reference any external variables.</span>

<span class="sd">            Args:</span>
<span class="sd">              one: First string.</span>
<span class="sd">              two: Second string.</span>

<span class="sd">            Returns:</span>
<span class="sd">              The score.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">one</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">two</span><span class="p">:</span>
                <span class="c1"># Edges are the best.</span>
                <span class="k">return</span> <span class="mi">6</span>

            <span class="c1"># Each port of this function behaves slightly differently due to</span>
            <span class="c1"># subtle differences in each language&#39;s definition of things like</span>
            <span class="c1"># &#39;whitespace&#39;.  Since this function&#39;s purpose is largely cosmetic,</span>
            <span class="c1"># the choice has been made to use each language&#39;s native features</span>
            <span class="c1"># rather than force total conformity.</span>
            <span class="n">char1</span> <span class="o">=</span> <span class="n">one</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">char2</span> <span class="o">=</span> <span class="n">two</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nonAlphaNumeric1</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">char1</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>
            <span class="n">nonAlphaNumeric2</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">char2</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>
            <span class="n">whitespace1</span> <span class="o">=</span> <span class="n">nonAlphaNumeric1</span> <span class="ow">and</span> <span class="n">char1</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span>
            <span class="n">whitespace2</span> <span class="o">=</span> <span class="n">nonAlphaNumeric2</span> <span class="ow">and</span> <span class="n">char2</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span>
            <span class="n">lineBreak1</span> <span class="o">=</span> <span class="n">whitespace1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">char1</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="ow">or</span> <span class="n">char1</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lineBreak2</span> <span class="o">=</span> <span class="n">whitespace2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">char2</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="ow">or</span> <span class="n">char2</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">blankLine1</span> <span class="o">=</span> <span class="n">lineBreak1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">BLANKLINEEND</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
            <span class="n">blankLine2</span> <span class="o">=</span> <span class="n">lineBreak2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">BLANKLINESTART</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">blankLine1</span> <span class="ow">or</span> <span class="n">blankLine2</span><span class="p">:</span>
                <span class="c1"># Five points for blank lines.</span>
                <span class="k">return</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">lineBreak1</span> <span class="ow">or</span> <span class="n">lineBreak2</span><span class="p">:</span>
                <span class="c1"># Four points for line breaks.</span>
                <span class="k">return</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">nonAlphaNumeric1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">whitespace1</span> <span class="ow">and</span> <span class="n">whitespace2</span><span class="p">:</span>
                <span class="c1"># Three points for end of sentences.</span>
                <span class="k">return</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">whitespace1</span> <span class="ow">or</span> <span class="n">whitespace2</span><span class="p">:</span>
                <span class="c1"># Two points for whitespace.</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">nonAlphaNumeric1</span> <span class="ow">or</span> <span class="n">nonAlphaNumeric2</span><span class="p">:</span>
                <span class="c1"># One point for non-alphanumeric.</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Intentionally ignore the first and last element (don&#39;t need checking).</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span> <span class="ow">and</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">):</span>
                <span class="c1"># This is a single edit surrounded by equalities.</span>
                <span class="n">equality1</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">edit</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">equality2</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># First, shift the edit as far left as possible.</span>
                <span class="n">commonOffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonSuffix</span><span class="p">(</span><span class="n">equality1</span><span class="p">,</span> <span class="n">edit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">commonOffset</span><span class="p">:</span>
                    <span class="n">commonString</span> <span class="o">=</span> <span class="n">edit</span><span class="p">[</span><span class="o">-</span><span class="n">commonOffset</span><span class="p">:]</span>
                    <span class="n">equality1</span> <span class="o">=</span> <span class="n">equality1</span><span class="p">[:</span><span class="o">-</span><span class="n">commonOffset</span><span class="p">]</span>
                    <span class="n">edit</span> <span class="o">=</span> <span class="n">commonString</span> <span class="o">+</span> <span class="n">edit</span><span class="p">[:</span><span class="o">-</span><span class="n">commonOffset</span><span class="p">]</span>
                    <span class="n">equality2</span> <span class="o">=</span> <span class="n">commonString</span> <span class="o">+</span> <span class="n">equality2</span>

                <span class="c1"># Second, step character by character right, looking for the best fit.</span>
                <span class="n">bestEquality1</span> <span class="o">=</span> <span class="n">equality1</span>
                <span class="n">bestEdit</span> <span class="o">=</span> <span class="n">edit</span>
                <span class="n">bestEquality2</span> <span class="o">=</span> <span class="n">equality2</span>
                <span class="n">bestScore</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff_cleanupSemanticScore</span><span class="p">(</span><span class="n">equality1</span><span class="p">,</span> <span class="n">edit</span><span class="p">)</span> <span class="o">+</span>
                             <span class="n">diff_cleanupSemanticScore</span><span class="p">(</span><span class="n">edit</span><span class="p">,</span> <span class="n">equality2</span><span class="p">))</span>
                <span class="k">while</span> <span class="n">edit</span> <span class="ow">and</span> <span class="n">equality2</span> <span class="ow">and</span> <span class="n">edit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">equality2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">equality1</span> <span class="o">+=</span> <span class="n">edit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">edit</span> <span class="o">=</span> <span class="n">edit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">equality2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">equality2</span> <span class="o">=</span> <span class="n">equality2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff_cleanupSemanticScore</span><span class="p">(</span><span class="n">equality1</span><span class="p">,</span> <span class="n">edit</span><span class="p">)</span> <span class="o">+</span>
                             <span class="n">diff_cleanupSemanticScore</span><span class="p">(</span><span class="n">edit</span><span class="p">,</span> <span class="n">equality2</span><span class="p">))</span>
                    <span class="c1"># The &gt;= encourages trailing rather than leading whitespace on edits.</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="n">bestScore</span><span class="p">:</span>
                        <span class="n">bestScore</span> <span class="o">=</span> <span class="n">score</span>
                        <span class="n">bestEquality1</span> <span class="o">=</span> <span class="n">equality1</span>
                        <span class="n">bestEdit</span> <span class="o">=</span> <span class="n">edit</span>
                        <span class="n">bestEquality2</span> <span class="o">=</span> <span class="n">equality2</span>

                <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">bestEquality1</span><span class="p">:</span>
                    <span class="c1"># We have an improvement, save it back to the diff.</span>
                    <span class="k">if</span> <span class="n">bestEquality1</span><span class="p">:</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bestEquality1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">pointer</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bestEdit</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bestEquality2</span><span class="p">:</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bestEquality2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">pointer</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="c1"># Define some regex patterns for matching boundaries.</span>
    <span class="n">BLANKLINEEND</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\r?\n$&quot;</span><span class="p">)</span>
    <span class="n">BLANKLINESTART</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\r?\n\r?\n&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="diff_match_patch.diff_cleanupEfficiency"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_cleanupEfficiency">[docs]</a>    <span class="k">def</span> <span class="nf">diff_cleanupEfficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reduce the number of edits by eliminating operationally trivial</span>
<span class="sd">        equalities.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">equalities</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Stack of indices where equalities are found.</span>
        <span class="n">lastEquality</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Always equal to diffs[equalities[-1]][1]</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Index of current position.</span>
        <span class="n">pre_ins</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is there an insertion operation before the last equality.</span>
        <span class="n">pre_del</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is there a deletion operation before the last equality.</span>
        <span class="n">post_ins</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is there an insertion operation after the last equality.</span>
        <span class="n">post_del</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is there a deletion operation after the last equality.</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>  <span class="c1"># Equality found.</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diff_EditCost</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">post_ins</span> <span class="ow">or</span> <span class="n">post_del</span><span class="p">)):</span>
                    <span class="c1"># Candidate found.</span>
                    <span class="n">equalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span>
                    <span class="n">pre_ins</span> <span class="o">=</span> <span class="n">post_ins</span>
                    <span class="n">pre_del</span> <span class="o">=</span> <span class="n">post_del</span>
                    <span class="n">lastEquality</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Not a candidate, and can never become one.</span>
                    <span class="n">equalities</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">lastEquality</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">post_ins</span> <span class="o">=</span> <span class="n">post_del</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># An insertion or deletion.</span>
                <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                    <span class="n">post_del</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">post_ins</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Five types to be split:</span>
                <span class="c1"># &lt;ins&gt;A&lt;/ins&gt;&lt;del&gt;B&lt;/del&gt;XY&lt;ins&gt;C&lt;/ins&gt;&lt;del&gt;D&lt;/del&gt;</span>
                <span class="c1"># &lt;ins&gt;A&lt;/ins&gt;X&lt;ins&gt;C&lt;/ins&gt;&lt;del&gt;D&lt;/del&gt;</span>
                <span class="c1"># &lt;ins&gt;A&lt;/ins&gt;&lt;del&gt;B&lt;/del&gt;X&lt;ins&gt;C&lt;/ins&gt;</span>
                <span class="c1"># &lt;ins&gt;A&lt;/del&gt;X&lt;ins&gt;C&lt;/ins&gt;&lt;del&gt;D&lt;/del&gt;</span>
                <span class="c1"># &lt;ins&gt;A&lt;/ins&gt;&lt;del&gt;B&lt;/del&gt;X&lt;del&gt;C&lt;/del&gt;</span>

                <span class="k">if</span> <span class="n">lastEquality</span> <span class="ow">and</span> <span class="p">((</span><span class="n">pre_ins</span> <span class="ow">and</span> <span class="n">pre_del</span> <span class="ow">and</span> <span class="n">post_ins</span> <span class="ow">and</span> <span class="n">post_del</span><span class="p">)</span> <span class="ow">or</span>
                                     <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lastEquality</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diff_EditCost</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span>
                                      <span class="p">(</span><span class="n">pre_ins</span> <span class="o">+</span> <span class="n">pre_del</span> <span class="o">+</span> <span class="n">post_ins</span> <span class="o">+</span> <span class="n">post_del</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)):</span>
                    <span class="c1"># Duplicate record.</span>
                    <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">lastEquality</span><span class="p">))</span>
                    <span class="c1"># Change second copy to insert.</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span>
                                                 <span class="n">diffs</span><span class="p">[</span><span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">equalities</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Throw away the equality we just deleted.</span>
                    <span class="n">lastEquality</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">pre_ins</span> <span class="ow">and</span> <span class="n">pre_del</span><span class="p">:</span>
                        <span class="c1"># No changes made which could affect previous entry, keep going.</span>
                        <span class="n">post_ins</span> <span class="o">=</span> <span class="n">post_del</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">equalities</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equalities</span><span class="p">):</span>
                            <span class="n">equalities</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Throw away the previous equality.</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equalities</span><span class="p">):</span>
                            <span class="n">pointer</span> <span class="o">=</span> <span class="n">equalities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pointer</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">post_ins</span> <span class="o">=</span> <span class="n">post_del</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">changes</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupMerge</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_cleanupMerge"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_cleanupMerge">[docs]</a>    <span class="k">def</span> <span class="nf">diff_cleanupMerge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reorder and merge like edit sections.  Merge equalities.</span>
<span class="sd">        Any edit section can move as long as it doesn&#39;t cross an equality.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>  <span class="c1"># Add a dummy entry at the end.</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_delete</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_insert</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text_delete</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text_insert</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">count_insert</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">text_insert</span> <span class="o">+=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">count_delete</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">text_delete</span> <span class="o">+=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="c1"># Upon reaching an equality, check for prior redundancies.</span>
                <span class="k">if</span> <span class="n">count_delete</span> <span class="o">+</span> <span class="n">count_insert</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">count_delete</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count_insert</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Factor out any common prefixies.</span>
                        <span class="n">commonlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonPrefix</span><span class="p">(</span><span class="n">text_insert</span><span class="p">,</span> <span class="n">text_delete</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">commonlength</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">pointer</span> <span class="o">-</span> <span class="n">count_delete</span> <span class="o">-</span> <span class="n">count_insert</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                                <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                            <span class="n">text_insert</span><span class="p">[:</span><span class="n">commonlength</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">text_insert</span><span class="p">[:</span><span class="n">commonlength</span><span class="p">]))</span>
                                <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">text_insert</span> <span class="o">=</span> <span class="n">text_insert</span><span class="p">[</span><span class="n">commonlength</span><span class="p">:]</span>
                            <span class="n">text_delete</span> <span class="o">=</span> <span class="n">text_delete</span><span class="p">[</span><span class="n">commonlength</span><span class="p">:]</span>
                        <span class="c1"># Factor out any common suffixies.</span>
                        <span class="n">commonlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_commonSuffix</span><span class="p">(</span><span class="n">text_insert</span><span class="p">,</span> <span class="n">text_delete</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">commonlength</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">text_insert</span><span class="p">[</span><span class="o">-</span><span class="n">commonlength</span><span class="p">:]</span> <span class="o">+</span>
                                              <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">text_insert</span> <span class="o">=</span> <span class="n">text_insert</span><span class="p">[:</span><span class="o">-</span><span class="n">commonlength</span><span class="p">]</span>
                            <span class="n">text_delete</span> <span class="o">=</span> <span class="n">text_delete</span><span class="p">[:</span><span class="o">-</span><span class="n">commonlength</span><span class="p">]</span>
                    <span class="c1"># Delete the offending records and add the merged ones.</span>
                    <span class="n">new_ops</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_delete</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">new_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">text_delete</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_insert</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">new_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">text_insert</span><span class="p">))</span>
                    <span class="n">pointer</span> <span class="o">-=</span> <span class="n">count_delete</span> <span class="o">+</span> <span class="n">count_insert</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">:</span> <span class="n">pointer</span> <span class="o">+</span> <span class="n">count_delete</span> <span class="o">+</span> <span class="n">count_insert</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_ops</span>
                    <span class="n">pointer</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_ops</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">pointer</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                    <span class="c1"># Merge this equality with the previous one.</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">count_insert</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">count_delete</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">text_delete</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">text_insert</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Remove the dummy entry at the end.</span>

        <span class="c1"># Second pass: look for single edits surrounded on both sides by equalities</span>
        <span class="c1"># which can be shifted sideways to eliminate an equality.</span>
        <span class="c1"># e.g: A&lt;ins&gt;BA&lt;/ins&gt;C -&gt; &lt;ins&gt;AB&lt;/ins&gt;AC</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Intentionally ignore the first and last element (don&#39;t need checking).</span>
        <span class="k">while</span> <span class="n">pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span> <span class="ow">and</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">):</span>
                <span class="c1"># This is a single edit surrounded by equalities.</span>
                <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="c1"># Shift the edit over the previous equality.</span>
                    <span class="k">if</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
                        <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">changes</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="c1"># Shift the edit over the next equality.</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):]</span> <span class="o">+</span>
                                      <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">diffs</span><span class="p">[</span><span class="n">pointer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">changes</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># If shifts were made, the diff needs reordering and another shift sweep.</span>
        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupMerge</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_xIndex"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_xIndex">[docs]</a>    <span class="k">def</span> <span class="nf">diff_xIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;loc is a location in text1, compute and return the equivalent location</span>
<span class="sd">        in text2.  e.g. &quot;The cat&quot; vs &quot;The big cat&quot;, 1-&gt;1, 5-&gt;8</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>
<span class="sd">          loc: Location within text1.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Location within text2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chars1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chars2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_chars1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_chars2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>  <span class="c1"># Equality or deletion.</span>
                <span class="n">chars1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>  <span class="c1"># Equality or insertion.</span>
                <span class="n">chars2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chars1</span> <span class="o">&gt;</span> <span class="n">loc</span><span class="p">:</span>  <span class="c1"># Overshot the location.</span>
                <span class="k">break</span>
            <span class="n">last_chars1</span> <span class="o">=</span> <span class="n">chars1</span>
            <span class="n">last_chars2</span> <span class="o">=</span> <span class="n">chars2</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
            <span class="c1"># The location was deleted.</span>
            <span class="k">return</span> <span class="n">last_chars2</span>
        <span class="c1"># Add the remaining len(character).</span>
        <span class="k">return</span> <span class="n">last_chars2</span> <span class="o">+</span> <span class="p">(</span><span class="n">loc</span> <span class="o">-</span> <span class="n">last_chars1</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_prettyHtml"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_prettyHtml">[docs]</a>    <span class="k">def</span> <span class="nf">diff_prettyHtml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a diff array into a pretty HTML report.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">          HTML representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;amp;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;para;&lt;br&gt;&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;ins style=</span><span class="se">\&quot;</span><span class="s2">background:#e6ffe6;</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">&lt;/ins&gt;&quot;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;del style=</span><span class="se">\&quot;</span><span class="s2">background:#ffe6e6;</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">&lt;/del&gt;&quot;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;</span><span class="si">%s</span><span class="s2">&lt;/span&gt;&quot;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_text1"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_text1">[docs]</a>    <span class="k">def</span> <span class="nf">diff_text1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute and return the source text (all equalities and deletions).</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Source text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_text2"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_text2">[docs]</a>    <span class="k">def</span> <span class="nf">diff_text2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute and return the destination text (all equalities and insertions).</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Destination text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_levenshtein"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_levenshtein">[docs]</a>    <span class="k">def</span> <span class="nf">diff_levenshtein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the Levenshtein distance; the number of inserted, deleted or</span>
<span class="sd">        substituted characters.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Number of changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">levenshtein</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">insertions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">deletions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">insertions</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">deletions</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="c1"># A deletion and an insertion is one substitution.</span>
                <span class="n">levenshtein</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">insertions</span><span class="p">,</span> <span class="n">deletions</span><span class="p">)</span>
                <span class="n">insertions</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">deletions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">levenshtein</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">insertions</span><span class="p">,</span> <span class="n">deletions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">levenshtein</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_toDelta"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_toDelta">[docs]</a>    <span class="k">def</span> <span class="nf">diff_toDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Crush the diff into an encoded string which describes the operations</span>
<span class="sd">        required to transform text1 into text2.</span>
<span class="sd">        E.g. =3\t-2\t+ing  -&gt; Keep 3 chars, delete 2 chars, insert &#39;ing&#39;.</span>
<span class="sd">        Operations are tab-separated.  Inserted text is escaped using %xx notation.</span>

<span class="sd">        Args:</span>
<span class="sd">          diffs: Array of diff tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Delta text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="c1"># High ascii will raise UnicodeDecodeError.  Use Unicode instead.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;!~*&#39;();/?:@&amp;=+$,# &quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.diff_fromDelta"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.diff_fromDelta">[docs]</a>    <span class="k">def</span> <span class="nf">diff_fromDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given the original text1, and an encoded string which describes the</span>
<span class="sd">        operations required to transform text1 into text2, compute the full diff.</span>

<span class="sd">        Args:</span>
<span class="sd">          text1: Source string for the diff.</span>
<span class="sd">          delta: Delta text.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of diff tuples.</span>

<span class="sd">        Raises:</span>
<span class="sd">          ValueError: If invalid input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Cursor in text1</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="c1"># Blank tokens are ok (from a trailing \t).</span>
                <span class="k">continue</span>
            <span class="c1"># Each token begins with a one character parameter which specifies the</span>
            <span class="c1"># operation of this token (delete, insert, equality).</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">param</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="ow">or</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid number in diff_fromDelta: &quot;</span> <span class="o">+</span> <span class="n">param</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative number in diff_fromDelta: &quot;</span> <span class="o">+</span> <span class="n">param</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text1</span><span class="p">[</span><span class="n">pointer</span><span class="p">:</span> <span class="n">pointer</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
                <span class="n">pointer</span> <span class="o">+=</span> <span class="n">n</span>
                <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
                    <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Anything else is an error.</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid diff operation in diff_fromDelta: &quot;</span> <span class="o">+</span>
                                 <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pointer</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Delta length (</span><span class="si">%d</span><span class="s2">) does not equal source text length (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">pointer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">diffs</span></div>

    <span class="c1">#  MATCH FUNCTIONS</span>

<div class="viewcode-block" id="diff_match_patch.match_main"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.match_main">[docs]</a>    <span class="k">def</span> <span class="nf">match_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locate the best instance of &#39;pattern&#39; in &#39;text&#39; near &#39;loc&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">          text: The text to search.</span>
<span class="sd">          pattern: The pattern to search for.</span>
<span class="sd">          loc: The location to search around.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Best match index or -1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for null inputs.</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Null inputs. (match_main)&quot;</span><span class="p">)</span>

        <span class="n">loc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="c1"># Shortcut (potentially not guaranteed by the algorithm)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="c1"># Nothing to match.</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">text</span><span class="p">[</span><span class="n">loc</span><span class="p">:</span><span class="n">loc</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)]</span> <span class="o">==</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="c1"># Perfect match at the perfect spot!  (Includes case of null pattern)</span>
            <span class="k">return</span> <span class="n">loc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Do a fuzzy compare.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_bitap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">match</span></div>

<div class="viewcode-block" id="diff_match_patch.match_bitap"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.match_bitap">[docs]</a>    <span class="k">def</span> <span class="nf">match_bitap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locate the best instance of &#39;pattern&#39; in &#39;text&#39; near &#39;loc&#39; using the</span>
<span class="sd">        Bitap algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">          text: The text to search.</span>
<span class="sd">          pattern: The pattern to search for.</span>
<span class="sd">          loc: The location to search around.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Best match index or -1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Python doesn&#39;t have a maxint limit, so ignore this check.</span>
        <span class="c1"># if self.Match_MaxBits != 0 and len(pattern) &gt; self.Match_MaxBits:</span>
        <span class="c1">#  raise ValueError(&quot;Pattern too long for this application.&quot;)</span>

        <span class="c1"># Initialise the alphabet.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_alphabet</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">match_bitapScore</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Compute and return the score for a match with e errors and x location.</span>
<span class="sd">            Accesses loc and pattern through being a closure.</span>

<span class="sd">            Args:</span>
<span class="sd">              e: Number of errors in match.</span>
<span class="sd">              x: Location of match.</span>

<span class="sd">            Returns:</span>
<span class="sd">              Overall score for match (0.0 = good, 1.0 = bad).</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="n">proximity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_Distance</span><span class="p">:</span>
                <span class="c1"># Dodge divide by zero error.</span>
                <span class="k">return</span> <span class="n">proximity</span> <span class="ow">and</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">accuracy</span>
            <span class="k">return</span> <span class="n">accuracy</span> <span class="o">+</span> <span class="p">(</span><span class="n">proximity</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Match_Distance</span><span class="p">))</span>

        <span class="c1"># Highest score beyond which we give up.</span>
        <span class="n">score_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_Threshold</span>
        <span class="c1"># Is there a nearby exact match? (speedup)</span>
        <span class="n">best_loc</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">best_loc</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">score_threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">match_bitapScore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">best_loc</span><span class="p">),</span> <span class="n">score_threshold</span><span class="p">)</span>
            <span class="c1"># What about in the other direction? (speedup)</span>
            <span class="n">best_loc</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">loc</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">best_loc</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">score_threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">match_bitapScore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">best_loc</span><span class="p">),</span> <span class="n">score_threshold</span><span class="p">)</span>

        <span class="c1"># Initialise the bit arrays.</span>
        <span class="n">matchmask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">best_loc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">bin_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Empty initialization added to appease pychecker.</span>
        <span class="n">last_rd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)):</span>
            <span class="c1"># Scan for the best match each iteration allows for one more error.</span>
            <span class="c1"># Run a binary search to determine how far from &#39;loc&#39; we can stray at</span>
            <span class="c1"># this error level.</span>
            <span class="n">bin_min</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bin_mid</span> <span class="o">=</span> <span class="n">bin_max</span>
            <span class="k">while</span> <span class="n">bin_min</span> <span class="o">&lt;</span> <span class="n">bin_mid</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">match_bitapScore</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">loc</span> <span class="o">+</span> <span class="n">bin_mid</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
                    <span class="n">bin_min</span> <span class="o">=</span> <span class="n">bin_mid</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bin_max</span> <span class="o">=</span> <span class="n">bin_mid</span>
                <span class="n">bin_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_max</span> <span class="o">-</span> <span class="n">bin_min</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">bin_min</span>

            <span class="c1"># Use the result from this iteration as the maximum for the next.</span>
            <span class="n">bin_max</span> <span class="o">=</span> <span class="n">bin_mid</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span> <span class="o">-</span> <span class="n">bin_mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">finish</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">loc</span> <span class="o">+</span> <span class="n">bin_mid</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

            <span class="n">rd</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">rd</span><span class="p">[</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">finish</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Out of range.</span>
                    <span class="n">charMatch</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">charMatch</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># First pass: exact match.</span>
                    <span class="n">rd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rd</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">charMatch</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Subsequent passes: fuzzy match.</span>
                    <span class="n">rd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">rd</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">charMatch</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
                        <span class="p">((</span><span class="n">last_rd</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="n">last_rd</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">last_rd</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">matchmask</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="n">match_bitapScore</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># This match will almost certainly be better than any existing match.</span>
                    <span class="c1"># But check anyway.</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
                        <span class="c1"># Told you so.</span>
                        <span class="n">score_threshold</span> <span class="o">=</span> <span class="n">score</span>
                        <span class="n">best_loc</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">best_loc</span> <span class="o">&gt;</span> <span class="n">loc</span><span class="p">:</span>
                            <span class="c1"># When passing loc, don&#39;t exceed our current distance from loc.</span>
                            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">loc</span> <span class="o">-</span> <span class="n">best_loc</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Already passed loc, downhill from here on in.</span>
                            <span class="k">break</span>
            <span class="c1"># No hope for a (better) match at greater error levels.</span>
            <span class="k">if</span> <span class="n">match_bitapScore</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">score_threshold</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">last_rd</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="k">return</span> <span class="n">best_loc</span></div>

<div class="viewcode-block" id="diff_match_patch.match_alphabet"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.match_alphabet">[docs]</a>    <span class="k">def</span> <span class="nf">match_alphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise the alphabet for the Bitap algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">          pattern: The text to encode.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Hash of character locations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">s</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)):</span>
            <span class="n">s</span><span class="p">[</span><span class="n">pattern</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

    <span class="c1">#  PATCH FUNCTIONS</span>

<div class="viewcode-block" id="diff_match_patch.patch_addContext"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_addContext">[docs]</a>    <span class="k">def</span> <span class="nf">patch_addContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increase the context until it is unique,</span>
<span class="sd">        but don&#39;t let the pattern expand beyond Match_MaxBits.</span>

<span class="sd">        Args:</span>
<span class="sd">          patch: The patch to grow.</span>
<span class="sd">          text: Source text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">patch</span><span class="o">.</span><span class="n">start2</span><span class="p">:</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span><span class="p">]</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Look for the first and last matches of pattern in text.  If two different</span>
        <span class="c1"># matches are found, increase the pattern length.</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">!=</span> <span class="n">text</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span> <span class="o">==</span>
                                                              <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span> <span class="o">-</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">)):</span>
            <span class="n">padding</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span>
                           <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+</span> <span class="n">padding</span><span class="p">]</span>
        <span class="c1"># Add one chunk for good luck.</span>
        <span class="n">padding</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span>

        <span class="c1"># Add the prefix.</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)]</span>
        <span class="c1"># Add the suffix.</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span><span class="p">:</span>
                      <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+</span> <span class="n">padding</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>

        <span class="c1"># Roll back the start points.</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="c1"># Extend lengths.</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_make"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_make">[docs]</a>    <span class="k">def</span> <span class="nf">patch_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute a list of patches to turn text1 into text2.</span>
<span class="sd">        Use diffs if provided, otherwise compute it ourselves.</span>
<span class="sd">        There are four ways to call this function, depending on what data is</span>
<span class="sd">        available to the caller:</span>
<span class="sd">        Method 1:</span>
<span class="sd">        a = text1, b = text2</span>
<span class="sd">        Method 2:</span>
<span class="sd">        a = diffs</span>
<span class="sd">        Method 3 (optimal):</span>
<span class="sd">        a = text1, b = diffs</span>
<span class="sd">        Method 4 (deprecated, use method 3):</span>
<span class="sd">        a = text1, b = text2, c = diffs</span>

<span class="sd">        Args:</span>
<span class="sd">          a: text1 (methods 1,3,4) or Array of diff tuples for text1 to</span>
<span class="sd">              text2 (method 2).</span>
<span class="sd">          b: text2 (methods 1,4) or Array of diff tuples for text1 to</span>
<span class="sd">              text2 (method 3) or undefined (method 2).</span>
<span class="sd">          c: Array of diff tuples for text1 to text2 (method 4) or</span>
<span class="sd">              undefined (methods 1,2,3).</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of Patch objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Method 1: text1, text2</span>
            <span class="c1"># Compute diffs from text1 and text2.</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupSemantic</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupEfficiency</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Method 2: diffs</span>
            <span class="c1"># Compute text1 from diffs.</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_text1</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Method 3: text1, diffs</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
              <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># Method 4: text1, text2, diffs</span>
            <span class="c1"># text2 is not used.</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown call format to patch_make.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffs</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># Get rid of the None case.</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_obj</span><span class="p">()</span>
        <span class="n">char_count1</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of characters into the text1 string.</span>
        <span class="n">char_count2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of characters into the text2 string.</span>
        <span class="n">prepatch_text</span> <span class="o">=</span> <span class="n">text1</span>  <span class="c1"># Recreate the patches to determine context info.</span>
        <span class="n">postpatch_text</span> <span class="o">=</span> <span class="n">text1</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">diff_type</span><span class="p">,</span> <span class="n">diff_text</span><span class="p">)</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">diff_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="c1"># A new patch starts here.</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">=</span> <span class="n">char_count1</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">=</span> <span class="n">char_count2</span>
            <span class="k">if</span> <span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="c1"># Insertion</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                <span class="n">postpatch_text</span> <span class="o">=</span> <span class="p">(</span><span class="n">postpatch_text</span><span class="p">[:</span><span class="n">char_count2</span><span class="p">]</span> <span class="o">+</span> <span class="n">diff_text</span> <span class="o">+</span>
                                  <span class="n">postpatch_text</span><span class="p">[</span><span class="n">char_count2</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="c1"># Deletion.</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                <span class="n">postpatch_text</span> <span class="o">=</span> <span class="p">(</span><span class="n">postpatch_text</span><span class="p">[:</span><span class="n">char_count2</span><span class="p">]</span> <span class="o">+</span>
                                  <span class="n">postpatch_text</span><span class="p">[</span><span class="n">char_count2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">):])</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span> <span class="ow">and</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span> <span class="ow">and</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Small equality inside a patch.</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span> <span class="ow">and</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">):</span>
                <span class="c1"># Time for a new patch.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">patch_addContext</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">prepatch_text</span><span class="p">)</span>
                    <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
                    <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_obj</span><span class="p">()</span>
                    <span class="c1"># Unlike Unidiff, our patch lists have a rolling context.</span>
                    <span class="c1"># https://github.com/google/diff-match-patch/wiki/Unidiff</span>
                    <span class="c1"># Update prepatch text &amp; pos to reflect the application of the</span>
                    <span class="c1"># just completed patch.</span>
                    <span class="n">prepatch_text</span> <span class="o">=</span> <span class="n">postpatch_text</span>
                    <span class="n">char_count1</span> <span class="o">=</span> <span class="n">char_count2</span>

            <span class="c1"># Update the current character count.</span>
            <span class="k">if</span> <span class="n">diff_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">char_count1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">char_count2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>

        <span class="c1"># Pick up the leftover patch if not empty.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patch_addContext</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">prepatch_text</span><span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">patches</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_deepCopy"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_deepCopy">[docs]</a>    <span class="k">def</span> <span class="nf">patch_deepCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given an array of patches, return another array that is identical.</span>

<span class="sd">        Args:</span>
<span class="sd">          patches: Array of Patch objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of Patch objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patchesCopy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
            <span class="n">patchCopy</span> <span class="o">=</span> <span class="n">patch_obj</span><span class="p">()</span>
            <span class="c1"># No need to deep copy the tuples since they are immutable.</span>
            <span class="n">patchCopy</span><span class="o">.</span><span class="n">diffs</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[:]</span>
            <span class="n">patchCopy</span><span class="o">.</span><span class="n">start1</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">start1</span>
            <span class="n">patchCopy</span><span class="o">.</span><span class="n">start2</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span>
            <span class="n">patchCopy</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span>
            <span class="n">patchCopy</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">length2</span>
            <span class="n">patchesCopy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patchCopy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">patchesCopy</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_apply"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_apply">[docs]</a>    <span class="k">def</span> <span class="nf">patch_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge a set of patches onto the text.  Return a patched text, as well</span>
<span class="sd">        as a list of true/false values indicating which patches were applied.</span>

<span class="sd">        Args:</span>
<span class="sd">          patches: Array of Patch objects.</span>
<span class="sd">          text: Old text.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Two element Array, containing the new text and an array of boolean values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">patches</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Deep copy the patches so that no changes are made to originals.</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_deepCopy</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>

        <span class="n">nullPadding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_addPadding</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">nullPadding</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="n">nullPadding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch_splitMax</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>

        <span class="c1"># delta keeps track of the offset between the expected and actual location</span>
        <span class="c1"># of the previous patch.  If there are patches expected at positions 10 and</span>
        <span class="c1"># 20, but the first patch was found at 12, delta is 2 and the second patch</span>
        <span class="c1"># has an effective expected position of 22.</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
            <span class="n">expected_loc</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="n">delta</span>
            <span class="n">text1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_text1</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span>
            <span class="n">end_loc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span><span class="p">:</span>
                <span class="c1"># patch_splitMax will only provide an oversized pattern in the case of</span>
                <span class="c1"># a monster delete.</span>
                <span class="n">start_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_main</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text1</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span><span class="p">],</span>
                                            <span class="n">expected_loc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start_loc</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">end_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_main</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text1</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span><span class="p">:],</span>
                                              <span class="n">expected_loc</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">end_loc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">start_loc</span> <span class="o">&gt;=</span> <span class="n">end_loc</span><span class="p">:</span>
                        <span class="c1"># Can&#39;t find valid trailing context.  Drop this patch.</span>
                        <span class="n">start_loc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_main</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">expected_loc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_loc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># No match found.  :(</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Subtract the delta for this failed patch from subsequent patches.</span>
                <span class="n">delta</span> <span class="o">-=</span> <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">-</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Found a match.  :)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">start_loc</span> <span class="o">-</span> <span class="n">expected_loc</span>
                <span class="k">if</span> <span class="n">end_loc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_loc</span><span class="p">:</span> <span class="n">start_loc</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_loc</span><span class="p">:</span> <span class="n">end_loc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">text1</span> <span class="o">==</span> <span class="n">text2</span><span class="p">:</span>
                    <span class="c1"># Perfect match, just shove the replacement text in.</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="n">start_loc</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_text2</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">text</span><span class="p">[</span><span class="n">start_loc</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">):])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Imperfect match.</span>
                    <span class="c1"># Run a diff to get a framework of equivalent indices.</span>
                    <span class="n">diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">diff_levenshtein</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">))</span> <span class="o">&gt;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Patch_DeleteThreshold</span><span class="p">):</span>
                        <span class="c1"># The end points match, but the content is unacceptably bad.</span>
                        <span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">diff_cleanupSemanticLossless</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
                        <span class="n">index1</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                                <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_xIndex</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>  <span class="c1"># Insertion</span>
                                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">start_loc</span> <span class="o">+</span> <span class="n">index2</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">start_loc</span> <span class="o">+</span>
                                                                               <span class="n">index2</span><span class="p">:]</span>
                            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>  <span class="c1"># Deletion</span>
                                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">start_loc</span> <span class="o">+</span> <span class="n">index2</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">start_loc</span> <span class="o">+</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">diff_xIndex</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">index1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):]</span>
                            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                                <span class="n">index1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Strip the padding off.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">nullPadding</span><span class="p">):</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">nullPadding</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_addPadding"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_addPadding">[docs]</a>    <span class="k">def</span> <span class="nf">patch_addPadding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add some padding on text start and end so that edges can match</span>
<span class="sd">        something.  Intended to be called only from within patch_apply.</span>

<span class="sd">        Args:</span>
<span class="sd">          patches: Array of Patch objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">          The padding string added to each side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paddingLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span>
        <span class="n">nullPadding</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">paddingLength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">nullPadding</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Bump all the patches forward.</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">+=</span> <span class="n">paddingLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+=</span> <span class="n">paddingLength</span>

        <span class="c1"># Add some padding on start of first diff.</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffs</span> <span class="ow">or</span> <span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
            <span class="c1"># Add nullPadding equality.</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">nullPadding</span><span class="p">))</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">-=</span> <span class="n">paddingLength</span>  <span class="c1"># Should be 0.</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-=</span> <span class="n">paddingLength</span>  <span class="c1"># Should be 0.</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="n">paddingLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="n">paddingLength</span>
        <span class="k">elif</span> <span class="n">paddingLength</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Grow first equality.</span>
            <span class="n">extraLength</span> <span class="o">=</span> <span class="n">paddingLength</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">newText</span> <span class="o">=</span> <span class="n">nullPadding</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]):]</span> <span class="o">+</span> <span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">newText</span><span class="p">)</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">-=</span> <span class="n">extraLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-=</span> <span class="n">extraLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="n">extraLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="n">extraLength</span>

        <span class="c1"># Add some padding on end of last diff.</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffs</span> <span class="ow">or</span> <span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
            <span class="c1"># Add nullPadding equality.</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">nullPadding</span><span class="p">))</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="n">paddingLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="n">paddingLength</span>
        <span class="k">elif</span> <span class="n">paddingLength</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Grow last equality.</span>
            <span class="n">extraLength</span> <span class="o">=</span> <span class="n">paddingLength</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">newText</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nullPadding</span><span class="p">[:</span><span class="n">extraLength</span><span class="p">]</span>
            <span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">newText</span><span class="p">)</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="n">extraLength</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="n">extraLength</span>

        <span class="k">return</span> <span class="n">nullPadding</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_splitMax"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_splitMax">[docs]</a>    <span class="k">def</span> <span class="nf">patch_splitMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look through the patches and break up any which are longer than the</span>
<span class="sd">        maximum limit of the match algorithm.</span>
<span class="sd">        Intended to be called only from within patch_apply.</span>

<span class="sd">        Args:</span>
<span class="sd">          patches: Array of Patch objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Match_MaxBits</span>
        <span class="k">if</span> <span class="n">patch_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Python has the option of not splitting strings due to its ability</span>
            <span class="c1"># to handle integers of arbitrary precision.</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patches</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">patches</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">length1</span> <span class="o">&lt;=</span> <span class="n">patch_size</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">bigpatch</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="c1"># Remove the big old patch.</span>
            <span class="k">del</span> <span class="n">patches</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">start1</span> <span class="o">=</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">start1</span>
            <span class="n">start2</span> <span class="o">=</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">start2</span>
            <span class="n">precontext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Create one of several smaller patches.</span>
                <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_obj</span><span class="p">()</span>
                <span class="n">empty</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">=</span> <span class="n">start1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">precontext</span><span class="p">)</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">=</span> <span class="n">start2</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">precontext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">precontext</span><span class="p">:</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">precontext</span><span class="p">)</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">precontext</span><span class="p">))</span>

                <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span>
                       <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">&lt;</span> <span class="n">patch_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">):</span>
                    <span class="p">(</span><span class="n">diff_type</span><span class="p">,</span> <span class="n">diff_text</span><span class="p">)</span> <span class="o">=</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                        <span class="c1"># Insertions are harmless.</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="n">start2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                          <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span> <span class="ow">and</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">patch_size</span><span class="p">):</span>
                        <span class="c1"># This is a large deletion.  Let it pass in one chunk.</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="n">start1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">diff_type</span><span class="p">,</span> <span class="n">diff_text</span><span class="p">))</span>
                        <span class="k">del</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Deletion or equality.  Only take as much as we can stomach.</span>
                        <span class="n">diff_text</span> <span class="o">=</span> <span class="n">diff_text</span><span class="p">[:</span><span class="n">patch_size</span> <span class="o">-</span> <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">-</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">]</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="n">start1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">diff_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                            <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                            <span class="n">start2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">diff_type</span><span class="p">,</span> <span class="n">diff_text</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">diff_text</span> <span class="o">==</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">del</span> <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">diff_text</span><span class="p">):])</span>

                <span class="c1"># Compute the head context for the next patch.</span>
                <span class="n">precontext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_text2</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span>
                <span class="n">precontext</span> <span class="o">=</span> <span class="n">precontext</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">:]</span>
                <span class="c1"># Append the end context for this patch.</span>
                <span class="n">postcontext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_text1</span><span class="p">(</span><span class="n">bigpatch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">Patch_Margin</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">postcontext</span><span class="p">:</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">postcontext</span><span class="p">)</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">postcontext</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                           <span class="n">postcontext</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">postcontext</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">patches</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_toText"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_toText">[docs]</a>    <span class="k">def</span> <span class="nf">patch_toText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Take a list of patches and return a textual representation.</span>

<span class="sd">        Args:</span>
<span class="sd">          patches: Array of Patch objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Text representation of patches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">patch</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="diff_match_patch.patch_fromText"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.diff_match_patch.patch_fromText">[docs]</a>    <span class="k">def</span> <span class="nf">patch_fromText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">textline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a textual representation of patches and return a list of patch</span>
<span class="sd">        objects.</span>

<span class="sd">        Args:</span>
<span class="sd">          textline: Text representation of patches.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Array of Patch objects.</span>

<span class="sd">        Raises:</span>
<span class="sd">          ValueError: If invalid input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">textline</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">patches</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">textline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid patch string: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_obj</span><span class="p">()</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

            <span class="k">del</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="c1"># Insertion.</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                    <span class="c1"># Deletion.</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="c1"># Minor equality.</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span>
                    <span class="c1"># Start of next patch.</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="c1"># Blank line?  Whatever.</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># WTF?</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid patch mode: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">patches</span></div></div>


<div class="viewcode-block" id="patch_obj"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.patch_obj">[docs]</a><span class="k">class</span> <span class="nc">patch_obj</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing one patch operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes with an empty list of diffs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length2</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="patch_obj.__str__"><a class="viewcode-back" href="../../../../modules/python_modules/python_modules.python_utils.diff_match_patch.diff_match_patch.html#python_modules.python_utils.diff_match_patch.diff_match_patch.patch_obj.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulate GNU diff&#39;s format.</span>
<span class="sd">        Header: @@ -382,8 +481,9 @@</span>
<span class="sd">        Indices are printed as 1-based, not 0-based.</span>

<span class="sd">        Returns:</span>
<span class="sd">          The GNU diff string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">coords1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,0&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">length1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">coords1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">coords2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,0&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">length2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">coords2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length2</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;@@ -&quot;</span><span class="p">,</span> <span class="n">coords1</span><span class="p">,</span> <span class="s2">&quot; +&quot;</span><span class="p">,</span> <span class="n">coords2</span><span class="p">,</span> <span class="s2">&quot; @@</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="c1"># Escape the body of the patch with %xx notation.</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">DIFF_EQUAL</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="c1"># High ascii will raise UnicodeDecodeError.  Use Unicode instead.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;!~*&#39;();/?:@&amp;=+$,# &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2021, Odyseus.

    </p>
  </div>
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a modified version of <a href="https://github.com/rtfd/sphinx_rtd_theme">sphinx-rtd-theme</a>. 

</footer>

        </div>
      </div>

      <a id="to-top-of-page" href="#top">
        <i class="fa fa-chevron-circle-up"></i>
      </a>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>